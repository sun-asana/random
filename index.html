<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Wheel Pro + Delete | sun-asana</title>
    <style>
        :root { --bg-color: #0a0a12; --panel-bg: #16213e; --neon: #ff00ff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 350px; background: var(--panel-bg); padding: 20px; box-shadow: 2px 0 15px rgba(0,0,0,0.5); overflow-y: auto; border-right: 1px solid #334; display: flex; flex-direction: column; gap: 15px; }
        .main { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1a2e 0%, #05050a 100%); position: relative; }
        h2 { color: #00d2ff; text-transform: uppercase; font-size: 18px; margin: 0; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; color: #aaa; }
        .color-tools { display: flex; gap: 10px; align-items: center; }
        #mainColor { width: 50px; height: 50px; border: none; background: none; cursor: pointer; }
        input[type="text"], textarea { background: #0f3460; border: 1px solid #334; color: white; padding: 8px; border-radius: 5px; width: 100%; box-sizing: border-box; }
        button { padding: 12px; background: #e94560; border: none; color: white; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        #codeOutput { height: 80px; font-family: monospace; font-size: 10px; background: #000; color: #0f0; margin-top: 10px; }
        .winner-display { margin-top: 20px; font-size: 24px; font-weight: bold; min-height: 35px; text-shadow: 0 0 10px var(--neon); color: #fff; text-align: center; }
        .checkbox-group { flex-direction: row; align-items: center; gap: 10px; cursor: pointer; }
        .checkbox-group input { width: auto; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>üé° Neon Editor v3</h2>
    <div class="form-group">
        <label>–≠–ª–µ–º–µ–Ω—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
        <textarea id="items" oninput="updatePreview()">–ë—É–º–∞–≥–∏, –¢—Ä–æ–ø–∏–Ω–∫–∏, –ö–≤–∞—Ä—Ç–∏—Ä—ã, –ö–ª–µ—Ç–æ—á–∫–∏, –¢–∞—Ä–∏—Ñ—ã, –®–∏–Ω—ã, –£—á–∞—Å—Ç–∫–∏</textarea>
    </div>
    <div class="form-group">
        <label>–¶–≤–µ—Ç –Ω–µ–æ–Ω–∞:</label>
        <div class="color-tools">
            <input type="color" id="mainColor" value="#ff00ff" oninput="syncColor(this.value)">
            <input type="text" id="colorHex" value="#ff00ff" oninput="syncColor(this.value)">
        </div>
    </div>
    <div class="form-group checkbox-group">
        <input type="checkbox" id="removeWinner" onchange="updatePreview()">
        <label for="removeWinner" style="cursor:pointer; color:#fff;">–£–¥–∞–ª—è—Ç—å –≤—ã–ø–∞–≤—à–∏–π —Å–µ–∫—Ç–æ—Ä</label>
    </div>
    <button onclick="copyCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è Genially</button>
    <textarea id="codeOutput" readonly></textarea>
</div>

<div class="main">
    <canvas id="previewCanvas" width="550" height="550"></canvas>
    <div id="winnerName" class="winner-display"></div>
</div>

<script>
    const canvas = document.getElementById('previewCanvas');
    const ctx = canvas.getContext('2d');
    const mainColorInput = document.getElementById('mainColor');
    const hexInput = document.getElementById('colorHex');
    const winnerDisplay = document.getElementById('winnerName');
    const removeCheck = document.getElementById('removeWinner');
    
    let angle = 0;
    let isSpinning = false;
    let currentSectors = [];

    function adjust(hex, mag) {
        hex = hex.replace('#', '');
        let r = Math.min(255, Math.max(0, parseInt(hex.substring(0,2), 16) * mag));
        let g = Math.min(255, Math.max(0, parseInt(hex.substring(2,4), 16) * mag));
        let b = Math.min(255, Math.max(0, parseInt(hex.substring(4,6), 16) * mag));
        return `rgb(${r},${g},${b})`;
    }

    function syncColor(val) {
        if(/^#[0-9A-F]{6}$/i.test(val)) {
            mainColorInput.value = val;
            hexInput.value = val;
            document.documentElement.style.setProperty('--neon', val);
            updatePreview();
        }
    }

    function drawWheel() {
        if (!isSpinning) {
            currentSectors = document.getElementById('items').value.split(',').map(s => s.trim()).filter(s => s !== "");
        }
        renderFrame(angle, currentSectors);
        generateFinalCode();
    }

    function renderFrame(currentAngle, sectors) {
        const baseColor = mainColorInput.value;
        const num = sectors.length;
        const arc = (Math.PI * 2) / num;
        const centerX = 275; const centerY = 275; const radius = 230;
        
        ctx.clearRect(0,0,550,550);

        sectors.forEach((text, i) => {
            const a = currentAngle + i * arc;
            const grad = ctx.createRadialGradient(centerX, centerY, 50, centerX, centerY, radius);
            grad.addColorStop(0, adjust(baseColor, 0.3));
            grad.addColorStop(1, adjust(baseColor, 1.1));
            
            ctx.beginPath();
            ctx.fillStyle = grad;
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, a, a + arc);
            ctx.fill();

            ctx.strokeStyle = adjust(baseColor, 1.8);
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(a + arc / 2);
            ctx.fillStyle = "#fff";
            ctx.font = "bold 16px sans-serif";
            ctx.textAlign = "right";
            ctx.fillText(text, radius - 20, 6);
            ctx.restore();
        });

        // –ö–æ–Ω—Ç—É—Ä
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.strokeStyle = adjust(baseColor, 0.5);
        ctx.lineWidth = 15;
        ctx.shadowBlur = 20;
        ctx.shadowColor = baseColor;
        ctx.stroke();
        ctx.shadowBlur = 0;

        // –£–∫–∞–∑–∞—Ç–µ–ª—å
        ctx.fillStyle = "#fff";
        ctx.shadowBlur = 15; ctx.shadowColor = "#fff";
        ctx.beginPath();
        ctx.moveTo(centerX - 20, 20); ctx.lineTo(centerX + 20, 20); ctx.lineTo(centerX, 60);
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    function spin() {
        if (isSpinning || currentSectors.length === 0) return;
        isSpinning = true;
        winnerDisplay.innerText = "";
        
        let rotation = Math.random() * 360 + 1440;
        let currentRotation = 0;

        const animate = () => {
            const step = (rotation - currentRotation) * 0.03 + 0.5;
            angle += step / 57.3;
            currentRotation += step;
            renderFrame(angle, currentSectors);

            if (currentRotation < rotation) {
                requestAnimationFrame(animate);
            } else {
                isSpinning = false;
                const arcSize = (Math.PI * 2) / currentSectors.length;
                const realAngle = (angle % (Math.PI * 2));
                const index = Math.floor(((Math.PI * 2.5 - realAngle) % (Math.PI * 2)) / arcSize);
                
                winnerDisplay.innerText = "–í—ã–ø–∞–ª–æ: " + currentSectors[index];

                if (removeCheck.checked && currentSectors.length > 1) {
                    setTimeout(() => {
                        currentSectors.splice(index, 1);
                        renderFrame(angle, currentSectors);
                    }, 1500);
                }
            }
        };
        animate();
    }

    function generateFinalCode() {
        const items = document.getElementById('items').value.split(',').map(s => s.trim()).filter(s => s !== "");
        const color = mainColorInput.value;
        const remove = removeCheck.checked;
        
        const finalMarkup = `
<div style="background:transparent; display:flex; flex-direction:column; align-items:center; width:100%;">
    <canvas id="wheelGen" width="550" height="550" style="width:100%; max-width:550px; cursor:pointer;"></canvas>
    <div id="status" style="color:#fff; font:bold 24px sans-serif; margin-top:10px; text-shadow:0 0 10px ${color}; min-height:35px; text-align:center;"></div>
</div>
<script>
(function(){
    const canvas = document.getElementById('wheelGen');
    const ctx = canvas.getContext('2d');
    const status = document.getElementById('status');
    let sectors = ${JSON.stringify(items)};
    let angle = 0; let spinning = false;
    const base = "${color}";

    function adj(h, m) {
        h = h.replace('#','');
        let r = Math.min(255, parseInt(h.substring(0,2),16)*m);
        let g = Math.min(255, parseInt(h.substring(2,4),16)*m);
        let b = Math.min(255, parseInt(h.substring(4,6),16)*m);
        return "rgb("+r+","+g+","+b+")";
    }

    function draw() {
        const arc = (Math.PI*2)/sectors.length;
        ctx.clearRect(0,0,550,550);
        sectors.forEach((t, i) => {
            const a = angle + i*arc;
            const g = ctx.createRadialGradient(275,275,50,275,275,230);
            g.addColorStop(0, adj(base, 0.4)); g.addColorStop(1, adj(base, 1.1));
            ctx.beginPath(); ctx.fillStyle = g; ctx.moveTo(275,275);
            ctx.arc(275,275,230, a, a+arc); ctx.fill();
            ctx.strokeStyle = adj(base, 1.8); ctx.lineWidth=2; ctx.stroke();
            ctx.save(); ctx.translate(275,275); ctx.rotate(a+arc/2);
            ctx.fillStyle="#fff"; ctx.font="bold 16px sans-serif"; ctx.textAlign="right";
            ctx.fillText(t, 210, 6); ctx.restore();
        });
        ctx.beginPath(); ctx.arc(275,275,230,0,Math.PI*2);
        ctx.strokeStyle=adj(base, 0.5); ctx.lineWidth=15; ctx.shadowBlur=20; ctx.shadowColor=base; ctx.stroke();
        ctx.shadowBlur=0; ctx.fillStyle="#fff"; ctx.shadowBlur=15; ctx.shadowColor="#fff";
        ctx.beginPath(); ctx.moveTo(255,20); ctx.lineTo(295,20); ctx.lineTo(275,60); ctx.fill();
    }

    canvas.onclick = () => {
        if(spinning || sectors.length < 1) return; 
        spinning = true; status.innerText = "";
        let rot = Math.random()*360 + 1440; let cur = 0;
        const anim = () => {
            let step = (rot-cur)*0.03 + 0.5; angle += step/57.3; cur += step;
            draw();
            if(cur < rot) requestAnimationFrame(anim);
            else {
                spinning = false;
                const idx = Math.floor(((Math.PI*2.5-(angle%(Math.PI*2)))%(Math.PI*2))/(Math.PI*2/sectors.length));
                status.innerText = "–í—ã–ø–∞–ª–æ: " + sectors[idx];
                if(${remove} && sectors.length > 1) {
                    setTimeout(() => { sectors.splice(idx,1); draw(); }, 1500);
                }
            }
        }; anim();
    }; draw();
})();
<\/script>`;
        document.getElementById('codeOutput').value = finalMarkup;
    }

    function copyCode() {
        document.getElementById("codeOutput").select();
        document.execCommand("copy");
        alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
    }

    function updatePreview() { drawWheel(); }
    canvas.onclick = spin;
    drawWheel();
</script>

</body>
</html>
